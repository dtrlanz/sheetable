<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <?!= include('tests/testStyle'); ?>
    <?!= requireLib(['sheetable', 'pet', 'numbers', 'tester', 'clientTests']); ?>
  </head>
  <body>
    <select id="tests" multiple size="8"></select>
    <div class="button-row">
        <button id="run" class="action" onclick="runTests()">Run</button>
        <button id="clear" onclick="clearOutput()">Clear</button>
    </div>
    <div id="test-output"></div>
    

    <script>
        const docId = '<?= docId ?>';

        const tests = [];
        const testSelect = document.getElementById('tests');
        populateTests();

        function populateTests() {
            for (const k in ClientTests) {
                if (typeof ClientTests[k] === 'function') {
                    const idx = tests.length;
                    tests.push(ClientTests[k]);
                    const opt = document.createElement('option');
                    opt.value = idx;
                    opt.innerText = ClientTests[k].name;
                    testSelect.appendChild(opt);
                }
            }
        }

        function runTests() {
            const options = testSelect.getElementsByTagName('option');
            for (let i = 0; i < options.length; i++) {
                if (options[i].selected) {
                    options[i].value;
                    const test = tests[options[i].value];
                    const tester = new Tester(options[i].innerText);
                    try {
                        test(tester);
                    } catch (e) {
                        tester.error(String(e));
                    }
                }
            }
        }

        function clearOutput() {
            const output = document.getElementById('test-output');
            output.replaceChildren();
        }

    </script>
  </body>
</html>